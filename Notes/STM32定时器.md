# STM32 定时器

## 定时功能

时基单元由三个16位的寄存器组成：预分频器+计数器+重装载寄存器

理解预分频器：https://zhuanlan.zhihu.com/p/82590576

STM32F103 内部时钟（CK_INT）频率为 72MHZ，相当于一秒钟可以计数 72 000 000次。计数器输入每遇到一次信号的上升沿，计数器加一。如果预分频器值为 0，则相当于分频系数为 1，那么计数器从 0 计数到 65535，一共可计时时长为 $65535 * \frac{1}{72M}$，即约$0.9\mu s$秒。如果预分频器值为 71，即分频系数为 71 + 1 = 72 的话，预分频器输出信号的每个周期时长为 72M / 72 = 1M，即 $1\mu s$，此时计数器计数 1000次，可以精确计时 $1000 * 1\mu s = 1 ms$ 。

## 输出比较功能

主要用于输出PWM波形，是驱动电机的必要条件。

### PWM (Pulse Width Modulation)

PWM 即脉冲宽度调制，应用在具有惯性的系统中，可以通过对一些列脉冲的宽度进行调制，等效地获得所需要的模拟参量，常用于电机控诉等领域。==一句话，使用PWM可以在数字系统等效输出模拟量==

PWM 参数：

频率：$f = \frac{1}{T_s}$ 

占空比：$Duty Cycle = \frac{T_{on}}{T_s}$

分辨率：$Resolution = min(DutyCycle)$，即占空比变化的精细程度

![STM32输出PWM波形_ARR_CNT_CCR](.\STM32定时器.assets\STM32输出PWM波形_ARR_CNT_CCR.png)



舵机![image-20240715232458836](.\STM32定时器.assets\image-20240715232458836.png)
