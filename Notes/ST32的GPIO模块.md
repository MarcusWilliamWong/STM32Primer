# ST32的GPIO模块

## 简介

GPIO（General Purpose Input Output）通用输入输出口，可配置8种输入输出模式。

引脚电平0-3.3V，部分容忍5V，具体查看STM32引脚手册，标注FT（Five Tolerate），不带FT只能接3.3V电压。

输出模式下，可控制端口输出高低电平，以驱动LED，蜂鸣器，模拟通信协议输出时序等；输入模式下，可以读取端口的高低电平，用于读取按键输入，外界模块电平信号输入，ADC电压采集，模拟通信协议接收数据等。

## 输入输出模式

GPIO口可以接收外界模块的数字电平信号；也可以配置成模拟输入模式，接收模拟信号。



|              GPIO_MODE               |     描述     |
| :----------------------------------: | :----------: |
|            GPIO_Mode_AIN             |   模拟输入   |
|        GPIO_Mode_IN_FLOATING         |   浮空输入   |
|            GPIO_Mode_IPD             |   下拉输入   |
|            GPIO_Mode_IPU             |   上拉输入   |
| GPIO_Mode_Out_OD (Open Drain Output) |   开漏输出   |
| GPIO_Mode_Out_PP (Push-Pull Output)  |   推挽输出   |
|           GPIO_Mode_AF_OD            | 复用开漏输出 |
|           GPIO_Mode_AF_PP            | 复用推挽输出 |

具体描述：https://blog.csdn.net/scarecrow_sun/article/details/120287852

### 四种输入模式

一种模拟信号输入和三种数字信号输入:模拟输入，浮空输入，上拉/下拉输入

- 浮空输入，一般需要外接一个上拉电阻或者下拉电阻；如果外接了上拉或下拉电阻，可以选择浮空输入；否则，在没有信号输入时，会呈现未定义状态。

- 上拉输入（**更常用**），开启后会连通芯片内部电路的上拉电阻，没有信号输入时，默认为高电平，当输入低电平信号时，会读取为低电平的数字信号。如果没有外接上拉电阻则需要设置为上拉输入；如果有外接上拉电阻，则引脚可以配置为浮空输入或者上拉输入，此时的上拉输入则为两个上拉电阻的共同作用。上拉模式，器件接地。
- 下拉模式：与上拉模式电路结构和特性相反，一般来说有些单片机不可以设置下拉模式，所以上拉模式更常用一些，可作为默认接法。

> 问题：单片机的外围电路设计及程序编写大多是以低电平有效来驱动电路的？
> 回答：这是因为单片机的低电平时的灌电流一般比高电平时的拉电流要大。如一般的51 系列单片机的I/O 口可以输出4mA 的拉电流或20mA 的灌电流；而其他也有一些芯片，如PIC单片机有一些非常实用的通用特性：I/O口灌电流/拉电流都很大——25MA/25MA。
>
> 总结：用低电平做驱动，灌电流大，驱动能力强。



### 四种输出模式：两种输出方式（开漏输出与推挽输出）结合两种模式（复用和非复用模式）

- 开漏输出模式：开漏输出无法真正输出高电平，即高电平时没有驱动能力，需要借助外部上拉电阻完成对外驱动。

- 推挽输出模式：推挽输出高低电平均具备电平驱动能力。



## GPIO输出模式下的输出速度

https://blog.csdn.net/qq_40044462



## GPIO模块结构

STM32芯片中的GPIO模块按照GPIOA，GPIOB...命名。每个GPIO外设总共一16个引脚，从PA0~PA15，PB0~PB15以此类推命名引脚号。GPIO模块内，包含寄存器和驱动器。内核可以通过APB2总线对寄存器进行读写。STM32芯片是32位单片机，寄存器也有32位，而每个寄存器有16个引脚，所以寄存器只有低16位对应有端口。驱动器用来增加信号的驱动能力。，寄存器只负责存储数据，

## 按键控制LED连接图

<img src=".\ST32的GPIO模块.assets\3-3 GPIO输入 电路连接图.jpg" style="zoom:10%;" />

按键下拉输入模式，一端接地，一端接GPIO口，GPIO口需配置为下拉输入模式。

LED低电平驱动模式，一端接VCC，一端接GPIO口，GPIO口设置即可开漏输出又可为推挽输出。



## TTL施密特触发器（迟滞/滞回比较器）

设置某一阈值，当输入信号高于上限或低于下限，改变输出信号为高电平或低电平。目的是为了解决输入信号的波动和噪声，造成输出抖动的现象。



